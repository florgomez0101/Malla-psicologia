<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Carrera de Psicolog√≠a</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
    }
    .active-tab {
      background-color: #e0e7ff;
      font-weight: bold;
    }
  </style>
  <style>
  @font-face {
    font-family: 'Perfect Penmanship';
    src: url('KGPerfectPenmanship.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }
  :root {
    --color-fondo-general: #fffde7; /* amarillo pastel */
    --color-fondo-anos: #dbe9f4; /* celeste pastel suave */
    --color-fondo-bloques: #dbe9f4; /* celeste pastel suave igual a√±os */
    --color-aprobada: #c8f7c5;
    --color-regular: #f8bbd0;
    --color-libre: #e1bee7;
    --color-cursable: #ffe0b2;
    --color-bloqueada: #e0e0e0;
  }

  h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 1rem;
  }
html {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: var(--color-fondo-general);
}

body {
  margin: 0;
  padding: 1rem;
  color: #333;
  background-color: var(--color-fondo-general);
  overflow-y: auto;   /* ‚úÖ scroll vertical activado */
  overflow-x: hidden; /* üîí sin scroll lateral */
}

  /* Panel de configuraci√≥n */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100vh;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  overflow-x: hidden;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;               /* volvemos a flex */
  flex-direction: column;     /* necesario para organizar inputs */
  gap: 1rem;                  /* espacio entre elementos */
  scrollbar-width: thin;
  max-height: 100vh;          /* asegura que no se corte */
  box-sizing: border-box;     /* incluye el padding en el alto */
}

 #panel-colores label {
  display: flex;
  flex-direction: column; /* Esto acomoda el texto arriba y el input abajo */
  font-size: 0.9rem;
  gap: 0.3rem;
}

#panel-colores label input,
#panel-colores label select {
  width: 100%;
}
  
  #panel-colores input[type=color] {
    width: 32px;
    height: 24px;
    border: none;
    padding: 0;
    cursor: pointer;
  }
#panel-colores::-webkit-scrollbar {
  width: 6px;
}

#panel-colores::-webkit-scrollbar-thumb {
  background-color: #bbb;
  border-radius: 4px;
}

  /* Malla en flex: a√±os como columnas */
  #malla {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
  }
  .year {
    background-color: var(--color-fondo-anos);
    border-radius: 10px;
    padding: 0.8rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    min-width: 240px;
    display: flex;
    flex-direction: column;
  }
  .year h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 0.8rem;
  }
  /* Bloques (Anual, Semestres) apilados vertical */
  .bloques {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .bloque {
    background-color: var(--color-fondo-bloques);
    border-radius: 8px;
    padding: 0.5rem 0.6rem;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
  }
  .bloque h4 {
    margin: 0 0 0.5rem 0.5rem;
    font-weight: bold;
    font-family: Arial, sans-serif;
  }
  /* Materias en columnas verticales (filas por materias) */
  .subject {
    background-color: var(--color-libre);
    border-radius: 8px;
    padding: 0.4rem 0.6rem;
    margin: 0.2rem 0.4rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-family: 'Perfect Penmanship', cursive;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .subject.estado-aprobada {
    background-color: var(--color-aprobada);
  }
  .subject.estado-regular {
    background-color: var(--color-regular);
  }
  .subject.estado-cursable {
    background-color: var(--color-cursable);
  }
  .subject.estado-libre {
    background-color: var(--color-libre);
  }
  .subject.bloqueada {
    background-color: var(--color-bloqueada);
    cursor: not-allowed;
    color: #777;
  }
  /* Scroll horizontal para malla si no cabe */
  @media (max-width: 768px) {
    #malla {
      flex-wrap: nowrap;
    }
  }
/* üçî Estilo del bot√≥n hamburguesa */
#toggle-menu {
  position: fixed;
  top: 1rem;
  left: 1rem;
  background-color: #333;
  color: white;
  border: none;
  font-size: 1.5rem;
  padding: 0.5rem 0.8rem;
  border-radius: 5px;
  cursor: pointer;
  z-index: 1000;
}

/* üßæ Men√∫ deslizante (panel de colores) */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100%;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Cuando el panel est√° abierto */
#panel-colores.abierto {
  left: 0;
}

/* Bot√≥n de cerrar */
#cerrar-menu {
  align-self: flex-end;
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: #444;
  margin-bottom: 1rem;
}
:root {
  --color-letras: #333333;
  --color-bordes: #bbbbbb;
}

/* Aplicamos color de letras y bordes a materias */
.subject {
  color: var(--color-letras);
  border: 1px solid var(--color-bordes);
}
#panel-colores label select,
#panel-colores label input[type=range] {
  margin-left: auto;
  flex-grow: 1;
}
body {
  font-family: var(--fuente-letra);
  font-size: var(--tamano-letra);
}
:root {
  --fuente-titulo: 'Perfect Penmanship', cursive;
  --tamano-titulo: 24px;

  --fuente-anios: 'Perfect Penmanship', cursive;
  --tamano-anios: 20px;

  --fuente-materias: 'Perfect Penmanship', cursive;
  --tamano-materias: 18px;
}

/* Aplica fuente y tama√±o al t√≠tulo principal */
h2 {
  font-family: var(--fuente-titulo);
  font-size: var(--tamano-titulo);
}

/* Aplica fuente y tama√±o a los t√≠tulos de a√±o */
.year h3 {
  font-family: var(--fuente-anios);
  font-size: var(--tamano-anios);
}

/* Aplica fuente y tama√±o a las materias */
.subject {
  font-family: var(--fuente-materias);
  font-size: var(--tamano-materias);
}
/* Men√∫ contextual personalizado */
#menu-bordes {
  position: absolute;
  display: none;
  background: #fff;
  border: 1px solid #ccc;
  z-index: 1000;
  padding: 0.5rem;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  font-family: sans-serif;
  font-size: 0.9rem;
  border-radius: 6px;
}

#menu-bordes label {
  display: flex;
  flex-direction: column;
  margin-bottom: 0.4rem;
}

#menu-bordes select,
#menu-bordes input[type=color],
#menu-bordes input[type=number] {
  margin-top: 0.2rem;
  font-size: 0.9rem;
}

  /* üß© Estilo para bordes personalizados */
.borde-editable {
  border-style: solid;
  border-width: 0;
  border-color: #333;
}

.borde-top {
  border-top-width: var(--borde-grosor, 2px);
  border-top-style: var(--borde-estilo, solid);
  border-top-color: var(--borde-color, #333);
}
.borde-right {
  border-right-width: var(--borde-grosor, 2px);
  border-right-style: var(--borde-estilo, solid);
  border-right-color: var(--borde-color, #333);
}
.borde-bottom {
  border-bottom-width: var(--borde-grosor, 2px);
  border-bottom-style: var(--borde-estilo, solid);
  border-bottom-color: var(--borde-color, #333);
}
.borde-left {
  border-left-width: var(--borde-grosor, 2px);
  border-left-style: var(--borde-estilo, solid);
  border-left-color: var(--borde-color, #333);
}

/* üß© Para evitar que el men√∫ contextual se corte */
#menu-bordes {
  max-width: 220px;
  font-size: 0.9rem;
}

  .subject.aprobada {
  text-decoration: line-through;
  opacity: 0.5;
}
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-contenido {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 300px;
  box-shadow: 0 0 10px #333;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.modal-contenido h3 {
  margin-top: 0;
  text-align: center;
}

.modal-botones {
  display: flex;
  justify-content: space-between;
}
.titulo-principal {
  font-family: var(--fuente-titulo, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-titulo, 32px);
}

.year h3 {
  font-family: var(--fuente-anos, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-anos, 24px);
}

.subject {
  font-family: var(--fuente-materias, 'Perfecte Penmanship'), cursive;
  font-size: var(--tamano-materias, 16px);
}

</style>

</head>
<body class="bg-[#fffefb] text-gray-800 h-screen flex">

  <!-- Sidebar izquierdo -->
  <aside class="w-64 bg-white shadow-lg flex flex-col p-4 space-y-4">
    <h1 class="text-2xl font-semibold text-center">üå∏ Hola Flor</h1>
    <button onclick="mostrarSeccion('malla')" id="btn-malla" class="text-left p-2 rounded hover:bg-indigo-100">üìö Malla Psicolog√≠a</button>
    <button onclick="mostrarSeccion('calendario')" id="btn-calendario" class="text-left p-2 rounded hover:bg-indigo-100">üóìÔ∏è Calendario</button>
    <button onclick="mostrarSeccion('resumenes')" id="btn-resumenes" class="text-left p-2 rounded hover:bg-indigo-100">üìù Res√∫menes</button>
  </aside>

  <!-- Contenido principal -->
  <main class="flex-1 overflow-y-auto p-6">
    <section id="malla" class="hidden">
      <h2 class="text-2xl font-bold mb-4">üìö Malla de Psicolog√≠a</h2>
      <div id="malla-container" role="table" aria-label="Malla curricular"></div>
    </section>

    <section id="calendario" class="hidden">
      <h2 class="text-2xl font-bold mb-4">üóìÔ∏è Calendario Acad√©mico</h2>
      <p>Aqu√≠ ir√° el calendario o Google Calendar embed.</p>
    </section>

    <section id="resumenes" class="hidden">
      <h2 class="text-2xl font-bold mb-4">üìù Res√∫menes por Materia</h2>
      <p>Aqu√≠ podr√°s cargar y ver tus res√∫menes por a√±o y materia.</p>
    </section>

    <section id="inicio" class="text-center">
      <h2 class="text-3xl font-bold mb-2">Bienvenida a tu espacio acad√©mico ‚ú®</h2>
      <p class="text-gray-600">Us√° el men√∫ lateral para navegar entre tus secciones.</p>
    </section>
  </main>

  <script>
    function mostrarSeccion(id) {
      const secciones = ['inicio', 'malla', 'calendario', 'resumenes'];
      secciones.forEach(sec => {
        document.getElementById(sec).style.display = sec === id ? 'block' : 'none';
        document.getElementById('btn-' + sec)?.classList.remove('active-tab');
      });
      document.getElementById('btn-' + id)?.classList.add('active-tab');
    }
  </script>
<script>
  const ESTADOS = ['libre', 'cursable', 'regular', 'aprobada'];
  const defaultColors = {
    'color-fondo-general': '#fffde7',
    'color-fondo-anos': '#dbe9f4',
    'color-fondo-bloques': '#dbe9f4',
    'color-aprobada': '#c8f7c5',
    'color-regular': '#f8bbd0',
    'color-cursable': '#ffe0b2',
    'color-libre': '#e1bee7',
    'color-bloqueada': '#e0e0e0',
  'color-letras': '#333333',
  'color-bordes': '#bbbbbb'

  };

  // Cargar colores guardados o defaults
  function cargarColores() {
    for (const key in defaultColors) {
      const color = localStorage.getItem(key) || defaultColors[key];
      document.getElementById(key).value = color;
      document.documentElement.style.setProperty(`--${key.replace('color-', 'color-')}`, color);
    }
  }

  // Guardar y aplicar color
  function cambiarColor(e) {
    const id = e.target.id;
    const val = e.target.value;
    localStorage.setItem(id, val);
    document.documentElement.style.setProperty(`--${id.replace('color-', 'color-')}`, val);
  }

  // A√±adir listeners a inputs de color
  function initPanelColores() {
    for (const key in defaultColors) {
      const input = document.getElementById(key);
      input.addEventListener('input', cambiarColor);
    }
  }

  // Datos materias
  const materias = {
    "1": {
      "Anual": [
        {nombre: "Filosof√≠a I", clave: "filo1", requisitos: [], regularidad: []},
        {nombre: "Historia de la Psicolog√≠a", clave: "histpsi", requisitos: [], regularidad: []},
        {nombre: "Metodolog√≠a de la Investigaci√≥n en Psicolog√≠a I", clave: "metod1", requisitos: [], regularidad: []},
        {nombre: "Neuropsicolog√≠a", clave: "neuro", requisitos: [], regularidad: []}
      ],
      "1¬∫ Semestre": [
        {nombre: "Psicolog√≠a General", clave: "psigral", requisitos: [], regularidad: []},
        {nombre: "Historia del Pensamiento Sociopol√≠tico", clave: "histpol", requisitos: [], regularidad: []}
      ],
      "2¬∫ Semestre": [
        {nombre: "Antropolog√≠a Cultural", clave: "antro", requisitos: ["histpol"], regularidad: ["histpol"]},
        {nombre: "Ling√º√≠stica", clave: "linguistica", requisitos: [], regularidad: []}
      ]
    },
    "2": {
      "Anual": [
        {nombre: "Estad√≠stica (Descriptiva y Muestral)", clave: "estadistica", requisitos: [], regularidad: []},
        {nombre: "Psicolog√≠a Evolutiva y Cultura (Ni√±o y Adolescente)", clave: "psievol", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Psicolog√≠a Profunda", clave: "psiprof", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Teolog√≠a I", clave: "teo1", requisitos: ["filo1"], regularidad: ["filo1"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Filosof√≠a II", clave: "filo2", requisitos: ["filo1"], regularidad: ["filo1"]},
        {nombre: "Psicoling√º√≠stica", clave: "psicolinguistica", requisitos: ["linguistica"], regularidad: ["linguistica"]},
        {nombre: "Sociolog√≠a", clave: "sociologia", requisitos: ["histpsi"], regularidad: ["histpsi"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Antropolog√≠a Filos√≥fica", clave: "antropfilo", requisitos: ["filo1","filo2"], regularidad: ["filo1","filo2"]},
        {nombre: "Introducci√≥n al Psicodiagn√≥stico", clave: "intropsi", requisitos: ["psigral","neuro"], regularidad: ["psigral","neuro"]},
        {nombre: "Psicolog√≠a de la Personalidad", clave: "psipersonal", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Psicolog√≠a Experimental", clave: "psiexp", requisitos: ["psigral","metod1"], regularidad: ["psigral","metod1"]}
      ]
    },
    "3": {
      "Anual": [
        {nombre: "Psicolog√≠a Educacional", clave: "psieduc", requisitos: ["histpsi","psigral","neuro","metod1","psievol"], regularidad: ["psievol"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Psicolog√≠a del Deporte", clave: "psidep", requisitos: ["psigral","neuro","sociologia","psievol"], regularidad: ["sociologia","psievol"]},
        {nombre: "Psicolog√≠a Evolutiva y Cultura de Adultez y Senectud", clave: "psievoladulto", requisitos: ["antro","psigral","psievol"], regularidad: ["psievol"]},
        {nombre: "Psicolog√≠a Social", clave: "psisocial", requisitos: ["histpsi","antro","sociologia","psievol"], regularidad: ["psievol","sociologia"]},
        {nombre: "Psicometr√≠a", clave: "psicomet", requisitos: ["metod1","estadistica"], regularidad: ["estadistica"]},
        {nombre: "Psicopatolog√≠a Infanto Juvenil", clave: "psicopatinf", requisitos: ["psigral","neuro","psievol","psipersonal"], regularidad: ["psigral","neuro","psievol","psipersonal"]},
        {nombre: "Teolog√≠a II", clave: "teo2", requisitos: ["teo1"], regularidad: ["teo1"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Din√°mica de Grupo", clave: "dinamgrupo", requisitos: ["histpsi","psisocial","psipersonal"], regularidad: ["histpsi","psisocial","psipersonal"]},
        {nombre: "Psicopatolog√≠a del Adulto", clave: "psicopatadul", requisitos: ["psicopatinf"], regularidad: ["psicopatinf"]},
        {nombre: "Seminario I", clave: "semin1", requisitos: ["psigral","psisocial","psiprof","psicolinguistica"], regularidad: ["psigral","psisocial","psiprof","psicolinguistica"]},
        {nombre: "T√©cnicas Proyectivas I", clave: "tecproy1", requisitos: ["psigral","psicomet","psievol","psievoladulto"], regularidad: ["psigral","psicomet","psievol","psievoladulto"]}
      ]
    },
    "4": {
      "Anual": [
        {nombre: "Psicolog√≠a Laboral", clave: "psilaboral", requisitos: ["psicomet","psisocial","dinamgrupo","tecproy1"], regularidad: ["psicomet","psisocial","dinamgrupo","tecproy1"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Doctrina Social", clave: "doctrinasoc", requisitos: ["teo2"], regularidad: ["teo2"]},
        {nombre: "Orientaci√≥n Vocacional y Profesional", clave: "orientacion", requisitos: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"], regularidad: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"]},
        {nombre: "Psicolog√≠a Especial y de la Diversidad", clave: "psiespdiv", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
        {nombre: "Seminario II", clave: "semin2", requisitos: ["psicopatadul","psievoladulto"], regularidad: ["psicopatadul","psievoladulto"]},
        {nombre: "T√©cnicas Proyectivas II", clave: "tecproy2", requisitos: ["tecproy1"], regularidad: ["tecproy1"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Drogodependencia y Abordajes Transdisciplinarios", clave: "drogodep", requisitos: ["psicopatadul","psisocial","psievoladulto","psieduc"], regularidad: ["psicopatadul","psisocial","psievoladulto","psieduc"]},
        {nombre: "Psicodiagn√≥stico", clave: "psicodiag", requisitos: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"], regularidad: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"]},
        {nombre: "Psicolog√≠a Cl√≠nica I (Psicoan√°lisis)", clave: "psicoclin1", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
        {nombre: "Psicolog√≠a Comunitaria", clave: "psicom", requisitos: ["intropsi","psipersonal","psisocial"], regularidad: ["intropsi","psipersonal","psisocial"]},
        {nombre: "Psicolog√≠a de las Relaciones Humanas", clave: "psirelhum", requisitos: ["psisocial"], regularidad: ["psisocial"]},
        {nombre: "√âtica Profesional", clave: "etica", requisitos: ["doctrinasoc"], regularidad: ["doctrinasoc"]}
      ]
    },
    "5": {
      "Anual": [
        {nombre: "Psicolog√≠a Cl√≠nica II", clave: "psicoclin2", requisitos: ["psicoclin1","psicodiag"], regularidad: ["psicoclin1","psicodiag"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Metodolog√≠a de la Investigaci√≥n en Psicolog√≠a II", clave: "metod2", requisitos: ["psicomet","tecproy1","tecproy2"], regularidad: ["psicomet","tecproy1","tecproy2"]},
        {nombre: "Psicolog√≠a de las Organizaciones", clave: "psiorg", requisitos: ["psilaboral"], regularidad: ["psilaboral"]},
        {nombre: "Psicolog√≠a Forense", clave: "psiforense", requisitos: ["psilaboral","dinamgrupo"], regularidad: ["psilaboral","dinamgrupo"]},
        {nombre: "Psicoterapia de Grupo", clave: "psitgroup", requisitos: ["psiespdiv","psicoclin1"], regularidad: ["psiespdiv","psicoclin1"]},
        {nombre: "Salud P√∫blica", clave: "saludpub", requisitos: ["psicom"], regularidad: ["psicom"]},
        {nombre: "Trabajo Integrador Final", clave: "trabint", requisitos: ["doctrinasoc","teo1","teo2","etica","histpol"], regularidad: ["doctrinasoc","teo1","teo2","etica","histpol"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Jur√≠dico Forense", clave: "juridfor", requisitos: ["etica","psicodiag","psiforense"], regularidad: ["etica","psicodiag","psiforense"]},
        {nombre: "Socio Comunitaria", clave: "sociocom", requisitos: ["psicom","psirelhum","psicodiag","saludpub","drogodep"], regularidad: ["psicom","psirelhum","psicodiag","saludpub","drogodep"]},
        {nombre: "Cl√≠nica", clave: "clinica", requisitos: ["psicoclin1","psicodiag","tecproy2","drogodep"], regularidad: ["psicoclin1","psicodiag","tecproy2","drogodep"]},
        {nombre: "Educacional", clave: "educacional", requisitos: ["psicodiag","psievoladulto","tecproy2","psieduc"], regularidad: ["psicodiag","psievoladulto","tecproy2","psieduc"]},
        {nombre: "Laboral", clave: "laboral", requisitos: ["psilaboral","psicodiag","tecproy2"], regularidad: ["psilaboral","psicodiag","tecproy2"]}
      ]
    }
  };

  function getEstado(clave) {
    return localStorage.getItem('estado_' + clave) || 'libre';
  }
  function setEstado(clave, estado) {
    localStorage.setItem('estado_' + clave, estado);
    renderMalla();
  }

  // Chequea si tiene regularidad para cursar
  function cumpleRegularidad(reqs) {
    return reqs.every(clave => {
      const estado = getEstado(clave);
      return estado === 'regular' || estado === 'aprobada';
    });
  }

  // Chequea si tiene requisitos para finalizar
  function cumpleFinalizacion(reqs) {
    return reqs.every(clave => getEstado(clave) === 'aprobada');
  }

  function renderMalla() {
    const cont = document.getElementById('malla');
    cont.innerHTML = '';

    // Ordenar a√±os
    const anios = Object.keys(materias).sort((a,b) => a-b);

    anios.forEach(anio => {
      const yearDiv = document.createElement('section');
      yearDiv.className = 'year';
      yearDiv.setAttribute('role','grid');
      yearDiv.setAttribute('aria-label', `${anio}¬∞ A√±o`);
      yearDiv.innerHTML = `<h3>${anio}¬∞ A√±o</h3>`;
      yearDiv.dataset.id = `anio-${anio}`;

      const bloquesDiv = document.createElement('div');
      bloquesDiv.className = 'bloques';

      ['Anual', '1¬∫ Semestre', '2¬∫ Semestre'].forEach(bloqueName => {
        if(!materias[anio][bloqueName]) return;
        const bloqueDiv = document.createElement('div');
        bloqueDiv.className = 'bloque';
        bloqueDiv.setAttribute('role','rowgroup');
        bloqueDiv.dataset.id = `bloque-${anio}-${bloqueName}`;

        const titulo = document.createElement('h4');
        titulo.textContent = bloqueName;
        bloqueDiv.appendChild(titulo);

        materias[anio][bloqueName].forEach(mat => {
          let estado = getEstado(mat.clave);
          let claseEstado = 'estado-' + estado;
          let tooltip = '';
          let puedeCursar = cumpleRegularidad(mat.regularidad);
          let puedeFinalizar = cumpleFinalizacion(mat.requisitos);

          if(!puedeCursar) {
            claseEstado = 'bloqueada';
            const faltan = mat.regularidad.filter(k => !['regular','aprobada'].includes(getEstado(k)));
            tooltip = 'Falta regularidad en:\n' + faltan.join(', ');
          } else if(estado === 'libre' && puedeCursar && !puedeFinalizar) {
            claseEstado = 'estado-cursable';
            tooltip = 'Habilitada para cursar, pero no para rendir final';
          }

          const matDiv = document.createElement('div');
          matDiv.className = `subject ${claseEstado}`;
          matDiv.setAttribute('role','gridcell');
          matDiv.setAttribute('tabindex','0');
          matDiv.setAttribute('title', tooltip || mat.nombre);
          matDiv.textContent = mat.nombre;
matDiv.dataset.clave = mat.clave;
matDiv.dataset.id = mat.clave;
if (estado === 'aprobada') {
  matDiv.classList.add('aprobada');
}
          
          if(claseEstado !== 'bloqueada'){
            matDiv.onclick = () => {
  const actual = getEstado(mat.clave);
  let nuevo;
  switch(actual){
    case 'libre': nuevo = 'cursable'; break;
    case 'cursable': nuevo = 'regular'; break;
    case 'regular': nuevo = 'aprobada'; break;
    case 'aprobada': nuevo = 'libre'; break;
    default: nuevo = 'libre';
  }

  setEstado(mat.clave, nuevo);

  // A√±adir o quitar clase visual para tachado y opacidad
  if (nuevo === 'aprobada') {
    matDiv.classList.add('aprobada');
  } else {
    matDiv.classList.remove('aprobada');
  }
};

            // Soporte teclado: Enter o espacio cambia estado
            matDiv.onkeydown = e => {
              if(e.key === 'Enter' || e.key === ' '){
                e.preventDefault();
                matDiv.click();
              }
            };
          }
matDiv.ondblclick = () => {
  abrirPanelMateria(mat.clave, mat.nombre);
};

          bloqueDiv.appendChild(matDiv);
        });

        bloquesDiv.appendChild(bloqueDiv);
      });

      yearDiv.appendChild(bloquesDiv);
      cont.appendChild(yearDiv);
    });
  }

// üçî Abrir y cerrar men√∫
document.getElementById('toggle-menu').onclick = () => {
  document.getElementById('panel-colores').classList.add('abierto');
};
document.getElementById('cerrar-menu').onclick = () => {
  document.getElementById('panel-colores').classList.remove('abierto');
};

// Aplicar fuentes y tama√±os personalizados
function aplicarTipografias() {
  const config = [
    { idFuente: 'fuente-titulo', idTamano: 'tamano-titulo', varFuente: '--fuente-titulo', varTamano: '--tamano-titulo' },
    { idFuente: 'fuente-anios', idTamano: 'tamano-anios', varFuente: '--fuente-anios', varTamano: '--tamano-anios' },
    { idFuente: 'fuente-materias', idTamano: 'tamano-materias', varFuente: '--fuente-materias', varTamano: '--tamano-materias' }
  ];

  config.forEach(({ idFuente, idTamano, varFuente, varTamano }) => {
    const fuente = localStorage.getItem(idFuente) || document.getElementById(idFuente).value;
    const tamano = localStorage.getItem(idTamano) || document.getElementById(idTamano).value;
    document.getElementById(idFuente).value = fuente;
    document.getElementById(idTamano).value = tamano;
    document.documentElement.style.setProperty(varFuente, fuente);
    document.documentElement.style.setProperty(varTamano, tamano + 'px');

    document.getElementById(idFuente).onchange = e => {
      localStorage.setItem(idFuente, e.target.value);
      document.documentElement.style.setProperty(varFuente, e.target.value);
    };
    document.getElementById(idTamano).oninput = e => {
      localStorage.setItem(idTamano, e.target.value);
      document.documentElement.style.setProperty(varTamano, e.target.value + 'px');
    };
  });
}
  
  // Inicializar colores guardados y listeners
cargarColores();
initPanelColores();
renderMalla();
cargarBordes(); // ‚úÖ Esto hace que los bordes guardados se apliquen despu√©s del render
aplicarTipografias();
  function abrirPanelMateria(clave, nombre) {
  const panel = document.getElementById("panel-materia");
  panel.style.display = "flex";

  document.getElementById("nombre-materia").textContent = nombre;
  panel.dataset.clave = clave;

  const datos = JSON.parse(localStorage.getItem("fechas-materia") || "{}")[clave] || {};

  document.getElementById("fecha-final").value = datos.fechaFinal || "";
  document.getElementById("fecha-regularidad").value = datos.fechaRegularidad || "";
}

function guardarFechasMateria() {
  const clave = document.getElementById("panel-materia").dataset.clave;
  const fechaFinal = document.getElementById("fecha-final").value;
  const fechaRegularidad = document.getElementById("fecha-regularidad").value;

  const datos = JSON.parse(localStorage.getItem("fechas-materia") || "{}");
  datos[clave] = { fechaFinal, fechaRegularidad };
  localStorage.setItem("fechas-materia", JSON.stringify(datos));

  cerrarPanelMateria();
}

function cerrarPanelMateria() {
  document.getElementById("panel-materia").style.display = "none";
}
function aplicarTipografias() {
  const partes = [
    { idFuente: 'fuente-titulo', varFuente: '--fuente-titulo' },
    { idFuente: 'fuente-anos', varFuente: '--fuente-anos' },
    { idFuente: 'fuente-materias', varFuente: '--fuente-materias' },
    { idTamano: 'tamano-titulo', varTamano: '--tamano-titulo' },
    { idTamano: 'tamano-anos', varTamano: '--tamano-anos' },
    { idTamano: 'tamano-materias', varTamano: '--tamano-materias' }
  ];

  partes.forEach(({ idFuente, varFuente, idTamano, varTamano }) => {
    if (idFuente) {
      const fuente = localStorage.getItem(idFuente);
      if (fuente) {
        document.documentElement.style.setProperty(varFuente, fuente);
        document.getElementById(idFuente).value = fuente;
      }

      document.getElementById(idFuente).oninput = e => {
        localStorage.setItem(idFuente, e.target.value);
        document.documentElement.style.setProperty(varFuente, e.target.value);
      };
    }

    if (idTamano) {
      const tam = localStorage.getItem(idTamano);
      if (tam) {
        document.documentElement.style.setProperty(varTamano, tam + 'px');
        document.getElementById(idTamano).value = tam;
      }

      document.getElementById(idTamano).oninput = e => {
        localStorage.setItem(idTamano, e.target.value);
        document.documentElement.style.setProperty(varTamano, e.target.value + 'px');
      };
    }
  });
}

</script>

<div id="menu-bordes">
  <label>
    Lado a editar:
    <select id="borde-lado">
      <option value="border">Todos</option>
      <option value="borderTop">Arriba</option>
      <option value="borderRight">Derecha</option>
      <option value="borderBottom">Abajo</option>
      <option value="borderLeft">Izquierda</option>
    </select>
  </label>
  <label>
    Estilo:
    <select id="borde-estilo">
      <option value="solid">S√≥lido</option>
      <option value="dashed">Punteado</option>
      <option value="dotted">Punteado fino</option>
      <option value="double">Doble</option>
    </select>
  </label>
  <label>
    Color:
    <input type="color" id="borde-color" value="#000000">
  </label>
  <label>
    Grosor (px):
    <input type="number" id="borde-grosor" value="2" min="1" max="10">
  </label>
  <button onclick="aplicarBorde()">Aplicar</button>
</div>

<script>
// === MEN√ö CONTEXTUAL PARA BORDES PERSONALIZADOS ===
let elementoActual = null;

document.addEventListener("contextmenu", function(e) {
  const objetivo = e.target.closest(".subject, .bloque, .year");
  if (objetivo) {
    e.preventDefault();
    elementoActual = objetivo;
    const menu = document.getElementById("menu-bordes");
    menu.style.display = "block";
    menu.style.top = `${e.pageY}px`;
    menu.style.left = `${e.pageX}px`;
  } else {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

document.addEventListener("click", function(e) {
  if (!e.target.closest("#menu-bordes")) {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

function aplicarBordes() {
  if (!elementoActual) return;
  
  const estilo = document.getElementById("estilo-borde").value;
  const grosor = document.getElementById("grosor-borde").value + "px";
  const color = document.getElementById("color-borde").value;

  // Limpiar bordes anteriores
  elementoActual.classList.remove("borde-top", "borde-right", "borde-bottom", "borde-left");
  
  // Aplicar clases seg√∫n checkboxes
  const checks = document.querySelectorAll("#menu-bordes input[type=checkbox]");
  checks.forEach(check => {
    if (check.checked) {
      elementoActual.classList.add("borde-" + check.dataset.borde);
    }
  });

  // Marcar como editable y guardar estilo
  elementoActual.classList.add("borde-editable");
  elementoActual.style.setProperty("--borde-estilo", estilo);
  elementoActual.style.setProperty("--borde-grosor", grosor);
  elementoActual.style.setProperty("--borde-color", color);

  // Guardar en localStorage
  guardarBordes();
  document.getElementById("menu-bordes").style.display = "none";
}

function guardarBordes() {
  const todos = document.querySelectorAll(".borde-editable");
  const datos = [];
  todos.forEach(el => {
    datos.push({
      selector: el.dataset.id || generarID(el),
      clases: Array.from(el.classList).filter(c => c.startsWith("borde-")),
      estilo: {
        estilo: el.style.getPropertyValue("--borde-estilo"),
        grosor: el.style.getPropertyValue("--borde-grosor"),
        color: el.style.getPropertyValue("--borde-color")
      }
    });
  });
  localStorage.setItem("bordes-personalizados", JSON.stringify(datos));
}

function cargarBordes() {
  const datos = JSON.parse(localStorage.getItem("bordes-personalizados") || "[]");
  datos.forEach(item => {
    const el = document.querySelector(`[data-id='${item.selector}']`);
    if (el) {
      el.classList.add("borde-editable", ...item.clases);
      el.style.setProperty("--borde-estilo", item.estilo.estilo);
      el.style.setProperty("--borde-grosor", item.estilo.grosor);
      el.style.setProperty("--borde-color", item.estilo.color);
    }
  });
}

function generarID(el) {
  if (!el.dataset.id) {
    el.dataset.id = "el-" + Math.random().toString(36).substr(2, 9);
  }
  return el.dataset.id;
}

// Ejecutar al cargar
window.addEventListener("DOMContentLoaded", cargarBordes);
</script>
  <div id="panel-materia" class="modal" style="display: none;">
  <div class="modal-contenido">
    <h3 id="nombre-materia"></h3>

    <label for="fecha-final">üìÖ L√≠mite para rendir final:</label>
    <input type="date" id="fecha-final">

    <label for="fecha-regularidad">üìÖ L√≠mite de regularidad:</label>
    <input type="date" id="fecha-regularidad">

    <div class="modal-botones">
      <button onclick="guardarFechasMateria()">Guardar</button>
      <button onclick="cerrarPanelMateria()">Cerrar</button>
    </div>
  </div>
</div>

</body>
</html>
