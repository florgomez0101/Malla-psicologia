<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Curricular Psicolog√≠a</title>
<style>
  @font-face {
    font-family: 'Perfect Penmanship';
    src: url('KGPerfectPenmanship.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }
  :root {
    --color-fondo-general: #fffde7; /* amarillo pastel */
    --color-fondo-anos: #dbe9f4; /* celeste pastel suave */
    --color-fondo-bloques: #dbe9f4; /* celeste pastel suave igual a√±os */
    --color-aprobada: #c8f7c5;
    --color-regular: #f8bbd0;
    --color-libre: #e1bee7;
    --color-cursable: #ffe0b2;
    --color-bloqueada: #e0e0e0;
  }

  h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 1rem;
  }
html {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: var(--color-fondo-general);
}

body {
  margin: 0;
  padding: 1rem;
  color: #333;
  background-color: var(--color-fondo-general);
  overflow-y: auto;   /* ‚úÖ scroll vertical activado */
  overflow-x: hidden; /* üîí sin scroll lateral */
}

  /* Panel de configuraci√≥n */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100vh;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  overflow-x: hidden;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;               /* volvemos a flex */
  flex-direction: column;     /* necesario para organizar inputs */
  gap: 1rem;                  /* espacio entre elementos */
  scrollbar-width: thin;
  max-height: 100vh;          /* asegura que no se corte */
  box-sizing: border-box;     /* incluye el padding en el alto */
}

 #panel-colores label {
  display: flex;
  flex-direction: column; /* Esto acomoda el texto arriba y el input abajo */
  font-size: 0.9rem;
  gap: 0.3rem;
}

#panel-colores label input,
#panel-colores label select {
  width: 100%;
}
  
  #panel-colores input[type=color] {
    width: 32px;
    height: 24px;
    border: none;
    padding: 0;
    cursor: pointer;
  }
#panel-colores::-webkit-scrollbar {
  width: 6px;
}

#panel-colores::-webkit-scrollbar-thumb {
  background-color: #bbb;
  border-radius: 4px;
}

  /* Malla en flex: a√±os como columnas */
  #malla {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
  }
  .year {
    background-color: var(--color-fondo-anos);
    border-radius: 10px;
    padding: 0.8rem;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    min-width: 240px;
    display: flex;
    flex-direction: column;
  }
  .year h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 0.8rem;
  }
  /* Bloques (Anual, Semestres) apilados vertical */
  .bloques {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .bloque {
    background-color: var(--color-fondo-bloques);
    border-radius: 8px;
    padding: 0.5rem 0.6rem;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
  }
  .bloque h4 {
    margin: 0 0 0.5rem 0.5rem;
    font-weight: bold;
    font-family: Arial, sans-serif;
  }
  /* Materias en columnas verticales (filas por materias) */
  .subject {
    background-color: var(--color-libre);
    border-radius: 8px;
    padding: 0.4rem 0.6rem;
    margin: 0.2rem 0.4rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-family: 'Perfect Penmanship', cursive;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .subject.estado-aprobada {
    background-color: var(--color-aprobada);
  }
  .subject.estado-regular {
    background-color: var(--color-regular);
  }
  .subject.estado-cursable {
    background-color: var(--color-cursable);
  }
  .subject.estado-libre {
    background-color: var(--color-libre);
  }
  .subject.bloqueada {
    background-color: var(--color-bloqueada);
    cursor: not-allowed;
    color: #777;
  }
  /* Scroll horizontal para malla si no cabe */
  @media (max-width: 768px) {
    #malla {
      flex-wrap: nowrap;
    }
  }
/* üçî Estilo del bot√≥n hamburguesa */
#toggle-menu {
  position: fixed;
  top: 1rem;
  left: 1rem;
  background-color: #333;
  color: white;
  border: none;
  font-size: 1.5rem;
  padding: 0.5rem 0.8rem;
  border-radius: 5px;
  cursor: pointer;
  z-index: 1000;
}

/* üßæ Men√∫ deslizante (panel de colores) */
#panel-colores {
  position: fixed;
  top: 0;
  left: -300px;
  width: 260px;
  height: 100%;
  background: white;
  padding: 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  transition: left 0.3s ease;
  z-index: 999;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Cuando el panel est√° abierto */
#panel-colores.abierto {
  left: 0;
}

/* Bot√≥n de cerrar */
#cerrar-menu {
  align-self: flex-end;
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: #444;
  margin-bottom: 1rem;
}
:root {
  --color-letras: #333333;
  --color-bordes: #bbbbbb;
}

/* Aplicamos color de letras y bordes a materias */
.subject {
  color: var(--color-letras);
  border: 1px solid var(--color-bordes);
}
#panel-colores label select,
#panel-colores label input[type=range] {
  margin-left: auto;
  flex-grow: 1;
}
body {
  font-family: var(--fuente-letra);
  font-size: var(--tamano-letra);
}
:root {
  --fuente-titulo: 'Perfect Penmanship', cursive;
  --tamano-titulo: 24px;

  --fuente-anios: 'Perfect Penmanship', cursive;
  --tamano-anios: 20px;

  --fuente-materias: 'Perfect Penmanship', cursive;
  --tamano-materias: 18px;
}

/* Aplica fuente y tama√±o al t√≠tulo principal */
h2 {
  font-family: var(--fuente-titulo);
  font-size: var(--tamano-titulo);
}

/* Aplica fuente y tama√±o a los t√≠tulos de a√±o */
.year h3 {
  font-family: var(--fuente-anios);
  font-size: var(--tamano-anios);
}

/* Aplica fuente y tama√±o a las materias */
.subject {
  font-family: var(--fuente-materias);
  font-size: var(--tamano-materias);
}
/* Men√∫ contextual personalizado */
#menu-bordes {
  position: absolute;
  display: none;
  background: #fff;
  border: 1px solid #ccc;
  z-index: 1000;
  padding: 0.5rem;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  font-family: sans-serif;
  font-size: 0.9rem;
  border-radius: 6px;
}

#menu-bordes label {
  display: flex;
  flex-direction: column;
  margin-bottom: 0.4rem;
}

#menu-bordes select,
#menu-bordes input[type=color],
#menu-bordes input[type=number] {
  margin-top: 0.2rem;
  font-size: 0.9rem;
}

  /* üß© Estilo para bordes personalizados */
.borde-editable {
  border-style: solid;
  border-width: 0;
  border-color: #333;
}

.borde-top {
  border-top-width: var(--borde-grosor, 2px);
  border-top-style: var(--borde-estilo, solid);
  border-top-color: var(--borde-color, #333);
}
.borde-right {
  border-right-width: var(--borde-grosor, 2px);
  border-right-style: var(--borde-estilo, solid);
  border-right-color: var(--borde-color, #333);
}
.borde-bottom {
  border-bottom-width: var(--borde-grosor, 2px);
  border-bottom-style: var(--borde-estilo, solid);
  border-bottom-color: var(--borde-color, #333);
}
.borde-left {
  border-left-width: var(--borde-grosor, 2px);
  border-left-style: var(--borde-estilo, solid);
  border-left-color: var(--borde-color, #333);
}

/* üß© Para evitar que el men√∫ contextual se corte */
#menu-bordes {
  max-width: 220px;
  font-size: 0.9rem;
}

  .materia.aprobada {
  text-decoration: line-through;
  opacity: 0.5;
}

</style>
</head>
<body>

<h2>Malla Curricular - Licenciatura en Psicolog√≠a</h2>

<!-- üçî Bot√≥n para abrir men√∫ -->
<button id="toggle-menu" title="Abrir men√∫">‚ò∞</button>

<!-- üé® Men√∫ deslizante -->
<div id="panel-colores" aria-label="Configuraci√≥n de colores">
  <button id="cerrar-menu" title="Cerrar men√∫">‚úï</button>
  <label for="color-fondo-general">Fondo general
    <input type="color" id="color-fondo-general" value="#fffde7" />
  </label>
  <label for="color-fondo-anos">Fondo a√±os
    <input type="color" id="color-fondo-anos" value="#dbe9f4" />
  </label>
  <label for="color-fondo-bloques">Fondo bloques
    <input type="color" id="color-fondo-bloques" value="#dbe9f4" />
  </label>
  <label for="color-aprobada">Estado aprobada
    <input type="color" id="color-aprobada" value="#c8f7c5" />
  </label>
  <label for="color-regular">Estado regular
    <input type="color" id="color-regular" value="#f8bbd0" />
  </label>
  <label for="color-cursable">Estado cursable
    <input type="color" id="color-cursable" value="#ffe0b2" />
  </label>
  <label for="color-libre">Estado libre
    <input type="color" id="color-libre" value="#e1bee7" />
  </label>
  <label for="color-bloqueada">Estado bloqueada
    <input type="color" id="color-bloqueada" value="#e0e0e0" />
  </label>
  <label for="color-letras">Color de letras
    <input type="color" id="color-letras" value="#333333" />
  </label>
  <label for="color-bordes">Color de bordes
    <input type="color" id="color-bordes" value="#bbbbbb" />
  </label>
<hr>

  <hr>
<h4>üé® Personalizar tipograf√≠a</h4>

<!-- Fuente y tama√±o del T√çTULO PRINCIPAL -->
<label for="fuente-titulo">Fuente T√≠tulo
  <select id="fuente-titulo">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-titulo">Tama√±o T√≠tulo
  <input type="range" id="tamano-titulo" min="16" max="40" value="24" />
</label>

<!-- Fuente y tama√±o de los A√ëOS -->
<label for="fuente-anios">Fuente A√±os
  <select id="fuente-anios">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-anios">Tama√±o A√±os
  <input type="range" id="tamano-anios" min="14" max="30" value="20" />
</label>

<!-- Fuente y tama√±o de las MATERIAS -->
<label for="fuente-materias">Fuente Materias
  <select id="fuente-materias">
    <option value="'Perfect Penmanship', cursive">Perfect Penmanship</option>
    <option value="Arial, sans-serif">Arial</option>
    <option value="'Segoe UI', sans-serif">Segoe UI</option>
    <option value="'Georgia', serif">Georgia</option>
    <option value="'Courier New', monospace">Courier New</option>
  </select>
</label>
<label for="tamano-materias">Tama√±o Materias
  <input type="range" id="tamano-materias" min="10" max="28" value="18" />
</label>
 
</div>
<!-- Men√∫ contextual para editar bordes -->
<div id="menu-bordes" style="display:none; position:absolute; background:white; border:1px solid #ccc; box-shadow:2px 2px 5px rgba(0,0,0,0.2); padding:10px; z-index:1000;">
  <label><input type="checkbox" data-borde="top"> Borde superior</label>
  <label><input type="checkbox" data-borde="right"> Borde derecho</label>
  <label><input type="checkbox" data-borde="bottom"> Borde inferior</label>
  <label><input type="checkbox" data-borde="left"> Borde izquierdo</label>
  <label>
    Estilo:
    <select id="estilo-borde">
      <option value="solid">L√≠nea</option>
      <option value="dashed">Punteado</option>
      <option value="dotted">Punteado fino</option>
      <option value="double">Doble</option>
    </select>
  </label>
  <label>
    Grosor:
    <input type="number" id="grosor-borde" value="2" min="1" max="10" style="width:50px">
  </label>
  <label>
    Color:
    <input type="color" id="color-borde" value="#333">
  </label>
  <button onclick="aplicarBordes()">Aplicar</button>
</div>
  
<!-- Contenedor malla -->
<div id="malla" role="table" aria-label="Malla curricular"></div>

<script>
  const ESTADOS = ['libre', 'cursable', 'regular', 'aprobada'];
  const defaultColors = {
    'color-fondo-general': '#fffde7',
    'color-fondo-anos': '#dbe9f4',
    'color-fondo-bloques': '#dbe9f4',
    'color-aprobada': '#c8f7c5',
    'color-regular': '#f8bbd0',
    'color-cursable': '#ffe0b2',
    'color-libre': '#e1bee7',
    'color-bloqueada': '#e0e0e0',
  'color-letras': '#333333',
  'color-bordes': '#bbbbbb'

  };

  // Cargar colores guardados o defaults
  function cargarColores() {
    for (const key in defaultColors) {
      const color = localStorage.getItem(key) || defaultColors[key];
      document.getElementById(key).value = color;
      document.documentElement.style.setProperty(`--${key.replace('color-', 'color-')}`, color);
    }
  }

  // Guardar y aplicar color
  function cambiarColor(e) {
    const id = e.target.id;
    const val = e.target.value;
    localStorage.setItem(id, val);
    document.documentElement.style.setProperty(`--${id.replace('color-', 'color-')}`, val);
  }

  // A√±adir listeners a inputs de color
  function initPanelColores() {
    for (const key in defaultColors) {
      const input = document.getElementById(key);
      input.addEventListener('input', cambiarColor);
    }
  }

  // Datos materias
  const materias = {
    "1": {
      "Anual": [
        {nombre: "Filosof√≠a I", clave: "filo1", requisitos: [], regularidad: []},
        {nombre: "Historia de la Psicolog√≠a", clave: "histpsi", requisitos: [], regularidad: []},
        {nombre: "Metodolog√≠a de la Investigaci√≥n en Psicolog√≠a I", clave: "metod1", requisitos: [], regularidad: []},
        {nombre: "Neuropsicolog√≠a", clave: "neuro", requisitos: [], regularidad: []}
      ],
      "1¬∫ Semestre": [
        {nombre: "Psicolog√≠a General", clave: "psigral", requisitos: [], regularidad: []},
        {nombre: "Historia del Pensamiento Sociopol√≠tico", clave: "histpol", requisitos: [], regularidad: []}
      ],
      "2¬∫ Semestre": [
        {nombre: "Antropolog√≠a Cultural", clave: "antro", requisitos: ["histpol"], regularidad: ["histpol"]},
        {nombre: "Ling√º√≠stica", clave: "linguistica", requisitos: [], regularidad: []}
      ]
    },
    "2": {
      "Anual": [
        {nombre: "Estad√≠stica (Descriptiva y Muestral)", clave: "estadistica", requisitos: [], regularidad: []},
        {nombre: "Psicolog√≠a Evolutiva y Cultura (Ni√±o y Adolescente)", clave: "psievol", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Psicolog√≠a Profunda", clave: "psiprof", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Teolog√≠a I", clave: "teo1", requisitos: ["filo1"], regularidad: ["filo1"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Filosof√≠a II", clave: "filo2", requisitos: ["filo1"], regularidad: ["filo1"]},
        {nombre: "Psicoling√º√≠stica", clave: "psicolinguistica", requisitos: ["linguistica"], regularidad: ["linguistica"]},
        {nombre: "Sociolog√≠a", clave: "sociologia", requisitos: ["histpsi"], regularidad: ["histpsi"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Antropolog√≠a Filos√≥fica", clave: "antropfilo", requisitos: ["filo1","filo2"], regularidad: ["filo1","filo2"]},
        {nombre: "Introducci√≥n al Psicodiagn√≥stico", clave: "intropsi", requisitos: ["psigral","neuro"], regularidad: ["psigral","neuro"]},
        {nombre: "Psicolog√≠a de la Personalidad", clave: "psipersonal", requisitos: ["psigral"], regularidad: ["psigral"]},
        {nombre: "Psicolog√≠a Experimental", clave: "psiexp", requisitos: ["psigral","metod1"], regularidad: ["psigral","metod1"]}
      ]
    },
    "3": {
      "Anual": [
        {nombre: "Psicolog√≠a Educacional", clave: "psieduc", requisitos: ["histpsi","psigral","neuro","metod1","psievol"], regularidad: ["psievol"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Psicolog√≠a del Deporte", clave: "psidep", requisitos: ["psigral","neuro","sociologia","psievol"], regularidad: ["sociologia","psievol"]},
        {nombre: "Psicolog√≠a Evolutiva y Cultura de Adultez y Senectud", clave: "psievoladulto", requisitos: ["antro","psigral","psievol"], regularidad: ["psievol"]},
        {nombre: "Psicolog√≠a Social", clave: "psisocial", requisitos: ["histpsi","antro","sociologia","psievol"], regularidad: ["psievol","sociologia"]},
        {nombre: "Psicometr√≠a", clave: "psicomet", requisitos: ["metod1","estadistica"], regularidad: ["estadistica"]},
        {nombre: "Psicopatolog√≠a Infanto Juvenil", clave: "psicopatinf", requisitos: ["psigral","neuro","psievol","psipersonal"], regularidad: ["psigral","neuro","psievol","psipersonal"]},
        {nombre: "Teolog√≠a II", clave: "teo2", requisitos: ["teo1"], regularidad: ["teo1"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Din√°mica de Grupo", clave: "dinamgrupo", requisitos: ["histpsi","psisocial","psipersonal"], regularidad: ["histpsi","psisocial","psipersonal"]},
        {nombre: "Psicopatolog√≠a del Adulto", clave: "psicopatadul", requisitos: ["psicopatinf"], regularidad: ["psicopatinf"]},
        {nombre: "Seminario I", clave: "semin1", requisitos: ["psigral","psisocial","psiprof","psicolinguistica"], regularidad: ["psigral","psisocial","psiprof","psicolinguistica"]},
        {nombre: "T√©cnicas Proyectivas I", clave: "tecproy1", requisitos: ["psigral","psicomet","psievol","psievoladulto"], regularidad: ["psigral","psicomet","psievol","psievoladulto"]}
      ]
    },
    "4": {
      "Anual": [
        {nombre: "Psicolog√≠a Laboral", clave: "psilaboral", requisitos: ["psicomet","psisocial","dinamgrupo","tecproy1"], regularidad: ["psicomet","psisocial","dinamgrupo","tecproy1"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Doctrina Social", clave: "doctrinasoc", requisitos: ["teo2"], regularidad: ["teo2"]},
        {nombre: "Orientaci√≥n Vocacional y Profesional", clave: "orientacion", requisitos: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"], regularidad: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"]},
        {nombre: "Psicolog√≠a Especial y de la Diversidad", clave: "psiespdiv", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
        {nombre: "Seminario II", clave: "semin2", requisitos: ["psicopatadul","psievoladulto"], regularidad: ["psicopatadul","psievoladulto"]},
        {nombre: "T√©cnicas Proyectivas II", clave: "tecproy2", requisitos: ["tecproy1"], regularidad: ["tecproy1"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Drogodependencia y Abordajes Transdisciplinarios", clave: "drogodep", requisitos: ["psicopatadul","psisocial","psievoladulto","psieduc"], regularidad: ["psicopatadul","psisocial","psievoladulto","psieduc"]},
        {nombre: "Psicodiagn√≥stico", clave: "psicodiag", requisitos: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"], regularidad: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"]},
        {nombre: "Psicolog√≠a Cl√≠nica I (Psicoan√°lisis)", clave: "psicoclin1", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
        {nombre: "Psicolog√≠a Comunitaria", clave: "psicom", requisitos: ["intropsi","psipersonal","psisocial"], regularidad: ["intropsi","psipersonal","psisocial"]},
        {nombre: "Psicolog√≠a de las Relaciones Humanas", clave: "psirelhum", requisitos: ["psisocial"], regularidad: ["psisocial"]},
        {nombre: "√âtica Profesional", clave: "etica", requisitos: ["doctrinasoc"], regularidad: ["doctrinasoc"]}
      ]
    },
    "5": {
      "Anual": [
        {nombre: "Psicolog√≠a Cl√≠nica II", clave: "psicoclin2", requisitos: ["psicoclin1","psicodiag"], regularidad: ["psicoclin1","psicodiag"]}
      ],
      "1¬∫ Semestre": [
        {nombre: "Metodolog√≠a de la Investigaci√≥n en Psicolog√≠a II", clave: "metod2", requisitos: ["psicomet","tecproy1","tecproy2"], regularidad: ["psicomet","tecproy1","tecproy2"]},
        {nombre: "Psicolog√≠a de las Organizaciones", clave: "psiorg", requisitos: ["psilaboral"], regularidad: ["psilaboral"]},
        {nombre: "Psicolog√≠a Forense", clave: "psiforense", requisitos: ["psilaboral","dinamgrupo"], regularidad: ["psilaboral","dinamgrupo"]},
        {nombre: "Psicoterapia de Grupo", clave: "psitgroup", requisitos: ["psiespdiv","psicoclin1"], regularidad: ["psiespdiv","psicoclin1"]},
        {nombre: "Salud P√∫blica", clave: "saludpub", requisitos: ["psicom"], regularidad: ["psicom"]},
        {nombre: "Trabajo Integrador Final", clave: "trabint", requisitos: ["doctrinasoc","teo1","teo2","etica","histpol"], regularidad: ["doctrinasoc","teo1","teo2","etica","histpol"]}
      ],
      "2¬∫ Semestre": [
        {nombre: "Jur√≠dico Forense", clave: "juridfor", requisitos: ["etica","psicodiag","psiforense"], regularidad: ["etica","psicodiag","psiforense"]},
        {nombre: "Socio Comunitaria", clave: "sociocom", requisitos: ["psicom","psirelhum","psicodiag","saludpub","drogodep"], regularidad: ["psicom","psirelhum","psicodiag","saludpub","drogodep"]},
        {nombre: "Cl√≠nica", clave: "clinica", requisitos: ["psicoclin1","psicodiag","tecproy2","drogodep"], regularidad: ["psicoclin1","psicodiag","tecproy2","drogodep"]},
        {nombre: "Educacional", clave: "educacional", requisitos: ["psicodiag","psievoladulto","tecproy2","psieduc"], regularidad: ["psicodiag","psievoladulto","tecproy2","psieduc"]},
        {nombre: "Laboral", clave: "laboral", requisitos: ["psilaboral","psicodiag","tecproy2"], regularidad: ["psilaboral","psicodiag","tecproy2"]}
      ]
    }
  };

  function getEstado(clave) {
    return localStorage.getItem('estado_' + clave) || 'libre';
  }
  function setEstado(clave, estado) {
    localStorage.setItem('estado_' + clave, estado);
    renderMalla();
  }

  // Chequea si tiene regularidad para cursar
  function cumpleRegularidad(reqs) {
    return reqs.every(clave => {
      const estado = getEstado(clave);
      return estado === 'regular' || estado === 'aprobada';
    });
  }

  // Chequea si tiene requisitos para finalizar
  function cumpleFinalizacion(reqs) {
    return reqs.every(clave => getEstado(clave) === 'aprobada');
  }

  function renderMalla() {
    const cont = document.getElementById('malla');
    cont.innerHTML = '';

    // Ordenar a√±os
    const anios = Object.keys(materias).sort((a,b) => a-b);

    anios.forEach(anio => {
      const yearDiv = document.createElement('section');
      yearDiv.className = 'year';
      yearDiv.setAttribute('role','grid');
      yearDiv.setAttribute('aria-label', `${anio}¬∞ A√±o`);
      yearDiv.innerHTML = `<h3>${anio}¬∞ A√±o</h3>`;

      const bloquesDiv = document.createElement('div');
      bloquesDiv.className = 'bloques';

      ['Anual', '1¬∫ Semestre', '2¬∫ Semestre'].forEach(bloqueName => {
        if(!materias[anio][bloqueName]) return;
        const bloqueDiv = document.createElement('div');
        bloqueDiv.className = 'bloque';
        bloqueDiv.setAttribute('role','rowgroup');

        const titulo = document.createElement('h4');
        titulo.textContent = bloqueName;
        bloqueDiv.appendChild(titulo);

        materias[anio][bloqueName].forEach(mat => {
          let estado = getEstado(mat.clave);
          let claseEstado = 'estado-' + estado;
          let tooltip = '';
          let puedeCursar = cumpleRegularidad(mat.regularidad);
          let puedeFinalizar = cumpleFinalizacion(mat.requisitos);

          if(!puedeCursar) {
            claseEstado = 'bloqueada';
            const faltan = mat.regularidad.filter(k => !['regular','aprobada'].includes(getEstado(k)));
            tooltip = 'Falta regularidad en:\n' + faltan.join(', ');
          } else if(estado === 'libre' && puedeCursar && !puedeFinalizar) {
            claseEstado = 'estado-cursable';
            tooltip = 'Habilitada para cursar, pero no para rendir final';
          }

          const matDiv = document.createElement('div');
          matDiv.className = `subject ${claseEstado}`;
          matDiv.setAttribute('role','gridcell');
          matDiv.setAttribute('tabindex','0');
          matDiv.setAttribute('title', tooltip || mat.nombre);
          matDiv.textContent = mat.nombre;

          if(claseEstado !== 'bloqueada'){
            matDiv.onclick = () => {
              // Ciclo de estados: libre -> cursable -> regular -> aprobada -> libre
              const actual = getEstado(mat.clave);
              let nuevo;
              switch(actual){
                case 'libre': nuevo = 'cursable'; break;
                case 'cursable': nuevo = 'regular'; break;
                case 'regular': nuevo = 'aprobada'; break;
                case 'aprobada': nuevo = 'libre'; break;
                default: nuevo = 'libre';
              }
              setEstado(mat.clave, nuevo);
            };
            // Soporte teclado: Enter o espacio cambia estado
            matDiv.onkeydown = e => {
              if(e.key === 'Enter' || e.key === ' '){
                e.preventDefault();
                matDiv.click();
              }
            };
          }

          bloqueDiv.appendChild(matDiv);
        });

        bloquesDiv.appendChild(bloqueDiv);
      });

      yearDiv.appendChild(bloquesDiv);
      cont.appendChild(yearDiv);
    });
  }

// üçî Abrir y cerrar men√∫
document.getElementById('toggle-menu').onclick = () => {
  document.getElementById('panel-colores').classList.add('abierto');
};
document.getElementById('cerrar-menu').onclick = () => {
  document.getElementById('panel-colores').classList.remove('abierto');
};

// Aplicar fuentes y tama√±os personalizados
function aplicarTipografias() {
  const config = [
    { idFuente: 'fuente-titulo', idTamano: 'tamano-titulo', varFuente: '--fuente-titulo', varTamano: '--tamano-titulo' },
    { idFuente: 'fuente-anios', idTamano: 'tamano-anios', varFuente: '--fuente-anios', varTamano: '--tamano-anios' },
    { idFuente: 'fuente-materias', idTamano: 'tamano-materias', varFuente: '--fuente-materias', varTamano: '--tamano-materias' }
  ];

  config.forEach(({ idFuente, idTamano, varFuente, varTamano }) => {
    const fuente = localStorage.getItem(idFuente) || document.getElementById(idFuente).value;
    const tamano = localStorage.getItem(idTamano) || document.getElementById(idTamano).value;
    document.getElementById(idFuente).value = fuente;
    document.getElementById(idTamano).value = tamano;
    document.documentElement.style.setProperty(varFuente, fuente);
    document.documentElement.style.setProperty(varTamano, tamano + 'px');

    document.getElementById(idFuente).onchange = e => {
      localStorage.setItem(idFuente, e.target.value);
      document.documentElement.style.setProperty(varFuente, e.target.value);
    };
    document.getElementById(idTamano).oninput = e => {
      localStorage.setItem(idTamano, e.target.value);
      document.documentElement.style.setProperty(varTamano, e.target.value + 'px');
    };
  });
}
  
  // Inicializar colores guardados y listeners
  cargarColores();
  initPanelColores();
  renderMalla();
aplicarTipografias();
</script>

<div id="menu-bordes">
  <label>
    Lado a editar:
    <select id="borde-lado">
      <option value="border">Todos</option>
      <option value="borderTop">Arriba</option>
      <option value="borderRight">Derecha</option>
      <option value="borderBottom">Abajo</option>
      <option value="borderLeft">Izquierda</option>
    </select>
  </label>
  <label>
    Estilo:
    <select id="borde-estilo">
      <option value="solid">S√≥lido</option>
      <option value="dashed">Punteado</option>
      <option value="dotted">Punteado fino</option>
      <option value="double">Doble</option>
    </select>
  </label>
  <label>
    Color:
    <input type="color" id="borde-color" value="#000000">
  </label>
  <label>
    Grosor (px):
    <input type="number" id="borde-grosor" value="2" min="1" max="10">
  </label>
  <button onclick="aplicarBorde()">Aplicar</button>
</div>

<script>
// === MEN√ö CONTEXTUAL PARA BORDES PERSONALIZADOS ===
let elementoActual = null;

document.addEventListener("contextmenu", function(e) {
  const objetivo = e.target.closest(".subject, .bloque, .year");
  if (objetivo) {
    e.preventDefault();
    elementoActual = objetivo;
    const menu = document.getElementById("menu-bordes");
    menu.style.display = "block";
    menu.style.top = `${e.pageY}px`;
    menu.style.left = `${e.pageX}px`;
  } else {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

document.addEventListener("click", function(e) {
  if (!e.target.closest("#menu-bordes")) {
    document.getElementById("menu-bordes").style.display = "none";
  }
});

function aplicarBordes() {
  if (!elementoActual) return;
  
  const estilo = document.getElementById("estilo-borde").value;
  const grosor = document.getElementById("grosor-borde").value + "px";
  const color = document.getElementById("color-borde").value;

  // Limpiar bordes anteriores
  elementoActual.classList.remove("borde-top", "borde-right", "borde-bottom", "borde-left");
  
  // Aplicar clases seg√∫n checkboxes
  const checks = document.querySelectorAll("#menu-bordes input[type=checkbox]");
  checks.forEach(check => {
    if (check.checked) {
      elementoActual.classList.add("borde-" + check.dataset.borde);
    }
  });

  // Marcar como editable y guardar estilo
  elementoActual.classList.add("borde-editable");
  elementoActual.style.setProperty("--borde-estilo", estilo);
  elementoActual.style.setProperty("--borde-grosor", grosor);
  elementoActual.style.setProperty("--borde-color", color);

  // Guardar en localStorage
  guardarBordes();
  document.getElementById("menu-bordes").style.display = "none";
}

function guardarBordes() {
  const todos = document.querySelectorAll(".borde-editable");
  const datos = [];
  todos.forEach(el => {
    datos.push({
      selector: el.dataset.id || generarID(el),
      clases: Array.from(el.classList).filter(c => c.startsWith("borde-")),
      estilo: {
        estilo: el.style.getPropertyValue("--borde-estilo"),
        grosor: el.style.getPropertyValue("--borde-grosor"),
        color: el.style.getPropertyValue("--borde-color")
      }
    });
  });
  localStorage.setItem("bordes-personalizados", JSON.stringify(datos));
}

function cargarBordes() {
  const datos = JSON.parse(localStorage.getItem("bordes-personalizados") || "[]");
  datos.forEach(item => {
    const el = document.querySelector(`[data-id='${item.selector}']`);
    if (el) {
      el.classList.add("borde-editable", ...item.clases);
      el.style.setProperty("--borde-estilo", item.estilo.estilo);
      el.style.setProperty("--borde-grosor", item.estilo.grosor);
      el.style.setProperty("--borde-color", item.estilo.color);
    }
  });
}

function generarID(el) {
  if (!el.dataset.id) {
    el.dataset.id = "el-" + Math.random().toString(36).substr(2, 9);
  }
  return el.dataset.id;
}

// Ejecutar al cargar
window.addEventListener("DOMContentLoaded", cargarBordes);
</script>
  
</body>
</html>
