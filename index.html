<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Malla Curricular Psicología</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #fffde7; /* amarillo pastel */
    color: #333;
    margin: 0;
    padding: 1rem;
  }
  h2 {
    text-align: center;
    color: #2c3e50;
  }
  .grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  .year {
    background-color: #ffffffd9;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .semestres {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  .semestre {
    background: #f9f9f9;
    border-radius: 8px;
    padding: 0.5rem;
  }
  .subject {
    border-radius: 8px;
    padding: 0.5rem;
    margin: 0.3rem 0;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s;
  }
  .tooltip {
    visibility: hidden;
    background-color: #444;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 0.3rem 0.6rem;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.8rem;
    white-space: pre-wrap;
  }
  .subject:hover .tooltip {
    visibility: visible;
    opacity: 1;
  }
  .nota {
    float: right;
    width: 2.5rem;
    text-align: center;
    font-size: 0.8rem;
  }
  .estado-aprobada {
    background-color: #c8f7c5;
  }
  .estado-regular {
    background-color: #f8bbd0;
  }
  .estado-libre {
    background-color: #e1bee7;
  }
  .estado-cursable {
    background-color: #ffe0b2;
  }
  .bloqueada {
    background-color: #e0e0e0;
    cursor: not-allowed;
  }
</style>
</head>
<body>
<h2>Malla Curricular - Licenciatura en Psicología</h2>
<div id="malla" class="grid"></div>

<script>
const ESTADOS = ['libre', 'cursable', 'regular', 'aprobada'];
const COLORES = {
  libre: 'estado-libre',
  cursable: 'estado-cursable',
  regular: 'estado-regular',
  aprobada: 'estado-aprobada'
};

const materias = {
  "1": {
    "Anual": [
      {nombre: "Filosofía I", clave: "filo1", requisitos: [], regularidad: []},
      {nombre: "Historia de la Psicología", clave: "histpsi", requisitos: [], regularidad: []},
      {nombre: "Metodología de la Investigación en Psicología I", clave: "metod1", requisitos: [], regularidad: []},
      {nombre: "Neuropsicología", clave: "neuro", requisitos: [], regularidad: []}
    ],
    "1º Semestre": [
      {nombre: "Psicología General", clave: "psigral", requisitos: [], regularidad: []},
      {nombre: "Historia del Pensamiento Sociopolítico", clave: "histpol", requisitos: [], regularidad: []}
    ],
    "2º Semestre": [
      {nombre: "Antropología Cultural", clave: "antro", requisitos: ["histpol"], regularidad: ["histpol"]},
      {nombre: "Lingüística", clave: "linguistica", requisitos: [], regularidad: []}
    ]
  },
  "2": {
    "Anual": [
      {nombre: "Estadística (Descriptiva y Muestral)", clave: "estadistica", requisitos: [], regularidad: []},
      {nombre: "Psicología Evolutiva y Cultura (Niño y Adolescente)", clave: "psievol", requisitos: ["psigral"], regularidad: ["psigral"]},
      {nombre: "Psicología Profunda", clave: "psiprof", requisitos: ["psigral"], regularidad: ["psigral"]},
      {nombre: "Teología I", clave: "teo1", requisitos: ["filo1"], regularidad: ["filo1"]}
    ],
    "1º Semestre": [
      {nombre: "Filosofía II", clave: "filo2", requisitos: ["filo1"], regularidad: ["filo1"]},
      {nombre: "Psicolingüística", clave: "psicolinguistica", requisitos: ["linguistica"], regularidad: ["linguistica"]},
      {nombre: "Sociología", clave: "sociologia", requisitos: ["histpsi"], regularidad: ["histpsi"]}
    ],
    "2º Semestre": [
      {nombre: "Antropología Filosófica", clave: "antropfilo", requisitos: ["filo1","filo2"], regularidad: ["filo1","filo2"]},
      {nombre: "Introducción al Psicodiagnóstico", clave: "intropsi", requisitos: ["psigral","neuro"], regularidad: ["psigral","neuro"]},
      {nombre: "Psicología de la Personalidad", clave: "psipersonal", requisitos: ["psigral"], regularidad: ["psigral"]},
      {nombre: "Psicología Experimental", clave: "psiexp", requisitos: ["psigral","metod1"], regularidad: ["psigral","metod1"]}
    ]
  },
  "3": {
    "Anual": [
      {nombre: "Psicología Educacional", clave: "psieduc", requisitos: ["histpsi","psigral","neuro","metod1","psievol"], regularidad: ["psievol"]}
    ],
    "1º Semestre": [
      {nombre: "Psicología del Deporte", clave: "psidep", requisitos: ["psigral","neuro","sociologia","psievol"], regularidad: ["sociologia","psievol"]},
      {nombre: "Psicología Evolutiva y Cultura de Adultez y Senectud", clave: "psievoladulto", requisitos: ["antro","psigral","psievol"], regularidad: ["psievol"]},
      {nombre: "Psicología Social", clave: "psisocial", requisitos: ["histpsi","antro","sociologia","psievol"], regularidad: ["psievol","sociologia"]},
      {nombre: "Psicometría", clave: "psicomet", requisitos: ["metod1","estadistica"], regularidad: ["estadistica"]},
      {nombre: "Psicopatología Infanto Juvenil", clave: "psicopatinf", requisitos: ["psigral","neuro","psievol","psipersonal"], regularidad: ["psigral","neuro","psievol","psipersonal"]},
      {nombre: "Teología II", clave: "teo2", requisitos: ["teo1"], regularidad: ["teo1"]}
    ],
    "2º Semestre": [
      {nombre: "Dinámica de Grupo", clave: "dinamgrupo", requisitos: ["histpsi","psisocial","psipersonal"], regularidad: ["histpsi","psisocial","psipersonal"]},
      {nombre: "Psicopatología del Adulto", clave: "psicopatadul", requisitos: ["psicopatinf"], regularidad: ["psicopatinf"]},
      {nombre: "Seminario I", clave: "semin1", requisitos: ["psigral","psisocial","psiprof","psicolinguistica"], regularidad: ["psigral","psisocial","psiprof","psicolinguistica"]},
      {nombre: "Técnicas Proyectivas I", clave: "tecproy1", requisitos: ["psigral","psicomet","psievol","psievoladulto"], regularidad: ["psigral","psicomet","psievol","psievoladulto"]}
    ]
  },
  "4": {
    "Anual": [
      {nombre: "Psicología Laboral", clave: "psilaboral", requisitos: ["psicomet","psisocial","dinamgrupo","tecproy1"], regularidad: ["psicomet","psisocial","dinamgrupo","tecproy1"]}
    ],
    "1º Semestre": [
      {nombre: "Doctrina Social", clave: "doctrinasoc", requisitos: ["teo2"], regularidad: ["teo2"]},
      {nombre: "Orientación Vocacional y Profesional", clave: "orientacion", requisitos: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"], regularidad: ["psiexp","psicomet","psievoladulto","tecproy1","psieduc"]},
      {nombre: "Psicología Especial y de la Diversidad", clave: "psiespdiv", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
      {nombre: "Seminario II", clave: "semin2", requisitos: ["psicopatadul","psievoladulto"], regularidad: ["psicopatadul","psievoladulto"]},
      {nombre: "Técnicas Proyectivas II", clave: "tecproy2", requisitos: ["tecproy1"], regularidad: ["tecproy1"]}
    ],
    "2º Semestre": [
      {nombre: "Drogodependencia y Abordajes Transdisciplinarios", clave: "drogodep", requisitos: ["psicopatadul","psisocial","psievoladulto","psieduc"], regularidad: ["psicopatadul","psisocial","psievoladulto","psieduc"]},
      {nombre: "Psicodiagnóstico", clave: "psicodiag", requisitos: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"], regularidad: ["intropsi","psievol","psiprof","psipersonal","psicomet","psievoladulto","tecproy1","tecproy2"]},
      {nombre: "Psicología Clínica I (Psicoanálisis)", clave: "psicoclin1", requisitos: ["psicopatadul"], regularidad: ["psicopatadul"]},
      {nombre: "Psicología Comunitaria", clave: "psicom", requisitos: ["intropsi","psipersonal"], regularidad: ["intropsi","psipersonal"]},
      {nombre: "Psicología de las Relaciones Humanas", clave: "psirelhum", requisitos: ["psisocial"], regularidad: ["psisocial"]},
      {nombre: "Ética Profesional", clave: "etica", requisitos: ["doctrinasoc"], regularidad: ["doctrinasoc"]}
    ]
  },
  "5": {
    "Anual": [
      {nombre: "Psicología Clínica II", clave: "psicoclin2", requisitos: ["psicoclin1","psicodiag"], regularidad: ["psicoclin1","psicodiag"]}
    ],
    "1º Semestre": [
      {nombre: "Metodología de la Investigación en Psicología II", clave: "metod2", requisitos: ["psicomet","tecproy1","tecproy2"], regularidad: ["psicomet","tecproy1","tecproy2"]},
      {nombre: "Psicología de las Organizaciones", clave: "psiorg", requisitos: ["psilaboral"], regularidad: ["psilaboral"]},
      {nombre: "Psicología Forense", clave: "psiforense", requisitos: ["psilaboral","dinamgrupo"], regularidad: ["psilaboral","dinamgrupo"]},
      {nombre: "Psicoterapia de Grupo", clave: "psitgroup", requisitos: ["psiespdiv","psicoclin1"], regularidad: ["psiespdiv","psicoclin1"]},
      {nombre: "Salud Pública", clave: "saludpub", requisitos: ["psicom"], regularidad: ["psicom"]},
      {nombre: "Trabajo Integrador Final", clave: "trabint", requisitos: ["doctrinasoc","teo1","teo2","etica","histpol"], regularidad: ["doctrinasoc","teo1","teo2","etica","histpol"]}
    ],
    "2º Semestre": [
      {nombre: "Jurídico Forense", clave: "juridfor", requisitos: ["etica","psicodiag","psiforense"], regularidad: ["etica","psicodiag","psiforense"]},
      {nombre: "Socio Comunitaria", clave: "sociocom", requisitos: ["psicom","psirelhum","psicodiag","saludpub","drogodep"], regularidad: ["psicom","psirelhum","psicodiag","saludpub","drogodep"]},
      {nombre: "Clínica", clave: "clinica", requisitos: ["psicoclin1","psicodiag","tecproy2","drogodep"], regularidad: ["psicoclin1","psicodiag","tecproy2","drogodep"]},
      {nombre: "Educacional", clave: "educacional", requisitos: ["psicodiag","psievoladulto","tecproy2","psieduc"], regularidad: ["psicodiag","psievoladulto","tecproy2","psieduc"]},
      {nombre: "Laboral", clave: "laboral", requisitos: ["psilaboral","psicodiag","tecproy2"], regularidad: ["psilaboral","psicodiag","tecproy2"]}
    ]
  }
};

function getEstado(clave) {
  return localStorage.getItem('estado_' + clave) || 'libre';
}

function setEstado(clave, estado) {
  localStorage.setItem('estado_' + clave, estado);
  renderMalla();
}

function getNota(clave) {
  return localStorage.getItem('nota_' + clave) || '';
}

function setNota(clave, nota) {
  localStorage.setItem('nota_' + clave, nota);
}

function cumpleRegularidad(reqs) {
  return reqs.every(clave => {
    const estado = getEstado(clave);
    return estado === 'regular' || estado === 'aprobada';
  });
}

function cumpleFinalizacion(reqs) {
  return reqs.every(clave => getEstado(clave) === 'aprobada');
}

function renderMalla() {
  const cont = document.getElementById('malla');
  cont.innerHTML = '';

  for (const [anio, bloques] of Object.entries(materias)) {
    const yearDiv = document.createElement('div');
    yearDiv.className = 'year';
    yearDiv.innerHTML = `<h3>${anio}° Año</h3>`;

    const semestresDiv = document.createElement('div');
    semestresDiv.className = 'semestres';

    // Mostrar semestres y anual en orden lógico (1º Sem, 2º Sem, Anual)
    ['1º Semestre', '2º Semestre', 'Anual'].forEach(sem => {
      if (!bloques[sem]) return;
      const semDiv = document.createElement('div');
      semDiv.className = 'semestre';
      semDiv.innerHTML = `<h4>${sem}</h4>`;

      bloques[sem].forEach(mat => {
        const estado = getEstado(mat.clave);
        const nota = getNota(mat.clave);
        let clase = COLORES[estado] || 'estado-libre';
        let tooltip = '';

        const puedeCursar = cumpleRegularidad(mat.regularidad);
        const puedeFinalizar = cumpleFinalizacion(mat.requisitos);

        if (!puedeCursar) {
          clase = 'bloqueada';
          const faltan = mat.regularidad.filter(k => !['regular', 'aprobada'].includes(getEstado(k)));
          tooltip = 'Falta regularidad en:\\n' + faltan.join(', ');
        } else if (estado === 'libre' && puedeCursar && !puedeFinalizar) {
          clase = 'estado-cursable';
          tooltip = 'Habilitada para cursar, pero no para rendir final';
        }

        const div = document.createElement('div');
        div.className = `subject ${clase}`;
        div.innerHTML = `${mat.nombre}<input class='nota' value='${nota}' title='Nota' onchange='setNota("${mat.clave}", this.value)'/><div class='tooltip'>${tooltip}</div>`;

        if (clase !== 'bloqueada') {
          div.onclick = () => {
            let nuevoEstado;
            switch (getEstado(mat.clave)) {
              case 'libre': nuevoEstado = 'cursable'; break;
              case 'cursable': nuevoEstado = 'regular'; break;
              case 'regular': nuevoEstado = 'aprobada'; break;
              case 'aprobada': nuevoEstado = 'libre'; break;
              default: nuevoEstado = 'libre';
            }
            setEstado(mat.clave, nuevoEstado);
          };
        }
        semDiv.appendChild(div);
      });
      semestresDiv.appendChild(semDiv);
    });
    yearDiv.appendChild(semestresDiv);
    cont.appendChild(yearDiv);
  }
}

renderMalla();
</script>
</body>
</html>
